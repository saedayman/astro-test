---
import Layout from '../layouts/Layout.astro';
import Showcase from '../components/Showcase.astro';
import Card from '../components/Card.astro';

// Fetch session data from our API endpoint
let sessionData = null;
try {
  const sessionResponse = await fetch(`${Astro.url.origin}/api/session`);
  if (sessionResponse.ok) {
    sessionData = await sessionResponse.json();
  }
} catch (error) {
  console.error('Failed to fetch session:', error);
}

// Fetch posts from JSONPlaceholder
const response = await fetch('https://jsonplaceholder.typicode.com/posts');
const posts = await response.json();
---

<Layout title="Astro Blog">
  <Showcase heading="Astro Blog" text="A simple blog built with Astro" />
  
  {sessionData && (
    <section class="page-content">
      <div class="container">
        <Card>
          <h3>Session Information</h3>
          <p><strong>Visitor ID:</strong> {sessionData.visitDetails?.visitorId}</p>
          <p><strong>Location:</strong> {sessionData.visitDetails?.city}, {sessionData.visitDetails?.region}, {sessionData.visitDetails?.country}</p>
          <p><strong>IP Address:</strong> {sessionData.visitDetails?.ip}</p>
          <p><strong>Platform:</strong> {sessionData.visitDetails?.platform}</p>
          <p><strong>Mobile:</strong> {sessionData.visitDetails?.isMobile ? 'Yes' : 'No'}</p>
        </Card>
      </div>
    </section>
  )}
  
  <section class="page-content">
    <div class="container">
      <h2>Blog Posts</h2>
      {posts.map(post => (
        <Card>
          <h3>{post.title}</h3>
          <div>
          Post ID: <strong>{post.id}</strong> | User ID: <strong>{post.userId}</strong>
        </div>
          <p>{post.body}</p>  
          <a class="btn" href={`/post/${post.id}`}>Read More</a>
        </Card>
      ))}
    </div>
  </section>
</Layout>
